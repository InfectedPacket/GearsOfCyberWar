/**
█▀▀▀▀█▀▀▀▀▀██▀▀▀▀██▀▀▀▀▀▀ ▀▀▀▀▀▀▀▀▀▀▀▓▒▀▀▀▀▀▀▀▀▀▀█▓▀ ▀▀▀██▀▀▀▀▀▀▀▀▀▓▓▀▀▀▀▀▀▀▀▀▌
▌▄██▌ ▄▓██▄ ▀▄█▓▄▐ ▄▓█▓▓▀█ ▄▓██▀▓██▓▄ ▌▄█▓█▀███▓▄ ▌▄█▓█ ▀ ▄▓██▀▓██▓▄ ▄█▓█▀███▄■
▌▀▓█▓▐▓██▓▓█ ▐▓█▓▌▐▓███▌■ ▒▓██▌  ▓██▓▌▐▓▒█▌▄ ▓██▓▌▐▓▒█▌▐ ▒▓██▌  ▓██▓▌▓▒█▌  ▓█▓▌
▐▓▄▄▌░▓▓█▓▐▓▌ █▓▓▌░▓▓█▓▄▄ ▓▓██▓▄▄▓█▓▓▌░▓█▓ █ ▓█▓▓▌░▓█▓ ▒ ▓▓██▓▄▄▓█▓▓▌▓█▓ ░ ▓█▓▓
▐▓▓█▌▓▓▓█▌ █▓▐██▓▌▐▓▒▓▌ ▄ ▐░▓█▌▄  ▀▀▀ ▐▓▓▓ ▐▌ ▀▀▀ ▐▓▓▓▄▄ ▐░▓█▌▄  ▀▀▀ ▓▓▓ ░ ██▓▓
▐▓▓▓█▐▓▒██  ██▓▓▓▌▐▓▓██ █▌▐▓▓▒▌▐ ███░▌▐▓▓▒▌▐ ███░▌▐▓▓▒▌  ▐▓▓▒▌▀ ███░▌▓▓▒▌  ███░
 ▒▓▓█▌▒▓▓█▌ ▐▓█▒▒  ▒▓██▌▐█ ▒▓▓█ ▐█▓▒▒  ▒▒▓█ ▐█▓▒▒  ▒▒▓█ ▓▌▒▓▓█ ▐█▓▒▒ ▒▒▓█ ▐█▓▒▌
▌ ▒▒░▀ ▓▒▓▀ ▀░▒▓ ▐▌ ▓▓▓▀ █  █▒▓▀▀░█▓ ▄▌ ▒▒▓▀▀░█▓ ▄▌ ▒▒▓▀▀  █▒▓▀▀░█▓   ▒▒▓▀▀░█▀
█▄ ▀ ▄▄ ▀▄▄▀■ ▀ ▀▓█▄ ▀ ▄█▓█▄ ▀ ▓▄▄▄▄▄█▀ ▄▀ ▄▄▄▄▄▄█▓▄ ▀ ▄▄█▓▄▀     ▄▓▄█▄▀  ▄▄▄█▌
▐████▓█▀ ▄▄█▓▓███▄▄ ▀▓▓████████████▓▀▄██▄▀▓██████▓▓██▓▓▓█▀▀▄▄███▓▓▄▄▄▀▀█▓████▌
░░▌▓▓▌ ▄▒▒▓▓▓▀▀█████▄ ▀▒░▄ ███▓█▀▀ ▄▓█▌▐▒█▄▀▀▀█▓█████▓▓▀ ▄█████▀▀▓▓▓▒▒▄ ▐▓▓▐░░
▐▒▒█▌ ▐░▓▓██▌   ▀▀█▓█▓▄▄▄ ▀█▀▀ ▄▒▓██▀▀  ▀▀██▓▓▄ ▀▀█▀ ▄▄▄▓█▓█▀ ▀  ▐██▓▓░▌ ▐█▒▒▌
 ▀▓█  ░▒▓███   ▄█▀▀▀▀▀▀▀█▓ ▄▒▓██▀    ▄▓▄     ▀▓██▓▄ ▓█▀▀▀▀▀▀▀▄█   ███▓▒░  █▓▀
 ▄█▀  ▀▒▓██▓▌ █▓  ▄▄█▓▓▄▄▄░▒▀▀   ▄▄ ▓░▒▓▓ ▄▄    ▀▀█▓▄▄▄▓▓█▄▄ ▓ █ ▐▓██▓▒▀  ▀█▄
▐▓▌     ▀▓█▀▀   ▄▓▓▓█▀  ▄▀▀  ▄▄▀▀    ▀▀▀    ▀▀▄▄   ▀▀▄  ▀█▓▓▓▄▄  ▀▀█▓▀     ▐▓▌
██         ▄▄▒█▐▒██▀   ▐▌  ■▀   ▄▄░▒▒▓████▓▄▄   ▀■   ▐▌   ▀██▒▌█▒▄▄         ██
▐▒▌      ▄▓▓▓█▒▒▒▓▌     ▀▄   ▄▓▒▒▒███████████▒▓▓▄   ▄▀     ▐▓▒▒▒█▓▓▓▄      ▐▒▌
 ▓▓▌    ▐▒██▀ ▐▒█▀       ▄▄▓▒▒▒▒▓███████████████▓▓▓▄        ▀█▒▌ ▀██▒▌    ▐▓▓
  ▀█    ▒▒▓▌  ▒▓▌     ▄▓▒▒▒▒█░█▓██████████████████▓▓▓▓▄      ▐▓▒  ▐▓▒▒    █▀
 ▄█▀▀  ▐▒█▀   ▐▓▓    ▓░░▓▒▒▓▓▓████████████████████▓▓▓▓▒▓     ▓▓▌   ▀█▒▌  ▀▀█▄
▐▓▌    ▒▓▌   ▄▄▒█▌▄ ▐░▒▒▓▓▓▀▀   ▀█▓█████████████▓▀▀█▓▓▓▓▌  ▄▐█▒▄▄   ▐▓▒    ▐▓▌
██     ▐▓▓ ▄▓▓▓█▒▓▌ ░▒░░▒▀        ▓▓█████████▓▀     ▀░▓▒▓▌ ▐▓▒█▓▓▓▄ ▓▓▌     ██
▐▒▌     ▒█▐▒██▀  ▒▓ ▐░░▒█  ▓  ▀   ▐▓████████▓▌  ▀  █ ▐▓▓▓  ▓▒  ▀██▒▌█▒     ▐▒▌
 ▓▓▌     ▒▒▒▓▌    ▀▒ ▀░▒▓▒▄ ▀▄▄█   █████████▓ ▐▌ ▄▀ ▄▒▓▒▌ ▒▀    ▐▓▒▒▒     ▐▓▓
  ▀█     ▐▒█▀▄▄        ▀▀█▓█▄▄   ▄█▒█▓▓▓▀▓████▄▀▀ ▄█▓█▒▀       ▄▄▀█▒▌     █▀
 ▄█▀▀    ▒▓▌▒▓▓▓▄    ▄░▒▓▄▄▀▓█▓████▓▀▀    ▓███▓█████▀▄▄▄     ▄▓▓▓▒▐▓▒    ▀▀█▄
▐▓▌      ▐▓▓ ▀██▒▌  ▐░▒▒▒▓██▄███▓▀         ▀▓██▓██▀▄█▓▒▓▓▄  ▐▒██▀ ▓▓▌      ▐▓▌
██      ▒█▒█▌ ▐▓▒▒  ░░▒▒█▓▓▓███▓▀           ▀▓████▓▓█▓█▓▓█  ▒▒▓▌ ▐█▒█▒      ██
▐▒▌    ▐▓▓ ▒▓▌ ▀█▒▌ ▒░▒░▒░▓▓██▓▄     ▄▄▄▓▄   ▄█▒▒█▒▒▓▓▒▓▓▓▌▐▒█▀ ▐▓▒ ▓▓▌    ▐▒▌
 ▓▓▌   ▒▓▌  ▒▓  ▐▓▒  ▀░░▒▒▒█████▓▄ ▄▓█████████▓██▒▒▒▒▓▓▓▒▓ ▒▓▌  ▓▒  ▐▓▒   ▐▓▓
  ▀█   ▐▒█▄  ▀▒ ▓▓▌    ▀▒░▒▓███▀▀▀▀▓█▀▀▀▀▀█▀▀▀▀▓▓█▓▒▓▓▒░▀  ▐▓▓ ▒▀  ▄█▒▌   █▀
 ▄█▀▀   ▒▒▓▌   ▐▄▒        ▀▀ ▄▓▓ █▄▄ ▄▀▀▀▄▄▀▄▀▀▀▄ ▀▀▀▀      ▒▄▌   ▐▓▒▒   ▀▀█▄
▐▓▌     ▐▒██▄ ▐▒▓   ▄▄▒█▌▄  ▐▒▒▌▀▐▌▀█▌ ▀▓ ▐█▌▀▀▌▒▌  ▄▐█▒▄▄   ▓▒▌ ▄██▒▌     ▐▓▌
██ cXc[CPH]▓▓█▒▓▌ ▄▓▓▓█▒▓▌   ▒▒▒██▄ ▄▄▀  ▄▄█▓▓█▓▒   ▐▓▒█▓▓▓ ▄▐▓▒█▓▓▓▀       ██
▐▒▌        ▀▀▒█▌▀▐▒██▀ ▐▒▓    ▀▒▒▒████████▓█▓▄▀▀    ▓▒▌ ▀██▐▒▀▐█▒▀▀        ▐▒▌
 ▓▓▌        ▐▓▓ ▒▒▒▓▌█▒▌▐▀▒      ▀░▒▒▓▓▓█▓▀▀       ▒▀▌▐▒█▐▓▒▒▒ ▓▓▌        ▐▓▓
 ▄▀█         ▒▄▌▐▒█▀▓▒▄▒ ▓▓▌        ▀▀▀▀          ▐▓▓ ▒▄▒▓▀▒█▌▐▄▒         █▀▄
▐▓▌ ▀         ▓▒▌ ▄██▒▌                                ▐▒██ ▄▐▒▓         ▀ ▐▓▌
██            ▐▓▒█▓▓▓▀                                  ▀▓▓█▓▒▓▌            ██
▐▒▌    ▄▄▄▓█▀■▀▐█▒▀▀                                      ▀▒▀█▌▀■▀█▓▄▄▄    ▐▒▌
 ▓▄▄███▓▀▀                                                          ▀▀█▓██▄▄▓
▄█▓▀▀                                                                    ▀▀▓█▄
█▓                                                                          ▓█
▓▒                                                                          ▒▓
▓                                                                            ▓
// <copyright file="XorCrypt.h" company="Jonathan Racicot">
//    C++ XOR Encryption/Decryption Implementation
//    Copyright (C) 2015 Jonathan Racicot
//
//    This program is free software: you can redistribute it and/or modify
//    it under the terms of the GNU General Public License as published by
//    the Free Software Foundation, either version 3 of the License, or
//    (at your option) any later version.
//
//    This program is distributed in the hope that it will be useful,
//    but WITHOUT ANY WARRANTY; without even the implied warranty of
//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//    GNU General Public License for more details.
//
//   You should have received a copy of the GNU General Public License
//    along with this program.  If not, see <http://www.gnu.org/licenses/>.
// </copyright>
// <author>Jonathan Racicot</author>
// <email>infectedpacket@gmail.com</email>
// <date>2015-03-01</date>
// <summary>C++ implementation of the XOR encryption/decryption mechanism.
// </summary>

▓                                                                            ▓
▓▌                                                                          ▐▓
▓█▄▄                                                                      ▄▄█▓
▓▐▓▓█▄▄                                                                ▄▄█▓▓▌▓
▓ ▀█▓██▄▄▄▄   ▄▄██▄▄▄                                    ▄▄▄██▄▄   ▄▄▄▄██▓█▀ ▓
▓  ▀█▓█▀████▄█▀▀▀▀▄▄▄▀▀▄                              ▄▀▀▄▄▄▀▀▀▀█▄████▀█▓█▀  ▓
▓  ▄█▓█▄████▀█▄▄▄▄▀▀▀▄▄▀                              ▀▄▄▀▀▀▄▄▄▄█▀████▄█▓█▄  ▓
▓ ▄█▓██▀▀▀▀   ▀▀██▀▀▀                                    ▀▀▀██▀▀   ▀▀▀▀██▓█▄ ▓
▓▐▓▓█▀▀                                                                ▀▀█▓▓▌▓
▓█▀▀      ▀▀▓▓███▀▀                                        ▀▀███▓▓▀▀      ▀▀█▓
       ▄▒▒▓▓▓▀▀█████▄                                    ▄█████▀▀▓▓▓▒▒▄
      ░▒▓█▄▄▓▓███▄▄▀▀▀▀▀█▓ ▄▒▓██▀            ▀▓██▓▄ ▓█▀▀▀▀▀▄▄███▓▓▄▄█▓▒░
 ▄█▀  ▀▄▒▒▓▓▓▀▀█████▄▓▓▄▄▄░▒▀▀                  ▀▀█▓▄▄▄▓▓▄█████▀▀▓▓▓▒▒▄▀  ▀█▄
       ▀▒▒▓▓▓▄▄█████▀                                    ▀█████▄▄▓▓▓▒▒▀
       ▀▒▒▀▀▓▓███▀▀█▀                                    ▀█▀▀███▓▓▀▀▒▒▀
          ▀▀▓▓███▀▀                                        ▀████▓▓▀▀
              ██ ■▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄■ █▓
              ▀█▓▄ NFO HEADER & LAYOUT BY CoaXCable/CoolPHay▄██▓
                ▀▀▀████████████████████████████████████████▓▀▀▀
                     ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀
Tag downloaded from http://legacy.sixteencolors.net/pack/cphart4/CXCINFEC.NFO
*/

#include <stdio.h>
#include "XorCrypt.h"


/**
<summary>
<para>Simple implementation of a null-preserving XOR cipher. The XOR cipher is an additive cipher
that operates according to the principles:</para>
A (+) 0 = A
A (+) A = 0
<para>This implementation uses the characters of the given byte array and XOR each byte of the given
with the corresponding byte of the given key. If the byte to encode is null (0x0), the byte is
ignored.</para>
</summary>
<param name="CipherData">An array of bytes to XOR. Must contain at least one item.</param>
<param name="DataLength">The number of bytes passed in CipherData.</param>
<param name="Key"></param>
<param name="KeyLength"></param>
<returns>An array of bytes XOR'd with the given key.</returns>
<see cref="http://en.wikipedia.org/wiki/XOR_cipher">XOR Cipher</see>
*/
unsigned char* XorCrypt(unsigned char* CipherData, unsigned int DataLength, 
	char* Key, unsigned int KeyLength) {
	
	if ((CipherData && DataLength > 0) &&
		(Key && KeyLength > 0)) {
		unsigned char* PlainData = new unsigned char[DataLength];
		unsigned int idx = 0;
		for (idx = 0; idx < DataLength; idx++) {
			if (PlainData[idx] != 0x0) { //Null-preserving 
				PlainData[idx] = (CipherData[idx] ^ Key[idx%KeyLength]);
			}
		}

		return PlainData;
	}

	return 0;
}


int TestXorCrypt() {
	unsigned char TestData[] = {0x0, 'A', 'B', 'C', 'D', '1', 0xFA};
	unsigned int TestDataLen = 7;
	char Key[] = {0x41};
	unsigned int KeyLen = 1;

	printf("[*] Test Bytes: ");
	for (unsigned int i = 0; i < TestDataLen; i++) {
		printf("0x%02X ", TestData[i]);
	}
	printf("\n");

	printf("[*] Key Bytes: ");
	for (unsigned int i = 0; i < KeyLen; i++) {
		printf("0x%02X ", Key[i]);
	}
	printf("\n");
	unsigned char* CipherData = XorCrypt(TestData, TestDataLen, Key, KeyLen);

	printf("[*] Result: ");
	for (unsigned int i = 0; i < TestDataLen; i++) {
		printf("0x%02X ", CipherData[i]);
	}
	printf("\n");

	return 0;
}